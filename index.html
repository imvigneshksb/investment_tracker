<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Investment Tracker</title>
    <link rel="stylesheet" href="styles.css" />
    <script>
      // Fast page initialization - use localStorage backup for immediate display
      (function () {
        // Try to get session from localStorage backup first
        let currentSession = null;
        let isLoggedIn = false;
        let currentPage = "login";

        try {
          const backupData = localStorage.getItem("userData_backup");
          if (backupData) {
            const userData = JSON.parse(backupData);
            currentSession = userData.sessions?.currentUser;
            isLoggedIn = userData.sessions?.isLoggedIn || false;
            currentPage =
              userData.sessions?.currentUser?.currentPage || "login";
          }
        } catch (error) {
          console.log("No backup session data found");
        }

        function showPage() {
          const login = document.getElementById("loginSection");
          const signup = document.getElementById("signupSection");
          const dashboard = document.getElementById("dashboardContent");
          const profileSettings = document.getElementById(
            "profileSettingsSection"
          );

          if (login && signup && dashboard && profileSettings) {
            // Hide all sections first
            login.style.display = "none";
            signup.style.display = "none";
            dashboard.style.display = "none";
            profileSettings.style.display = "none";

            if (isLoggedIn && currentSession) {
              if (currentPage === "profile-settings") {
                profileSettings.style.display = "block";
              } else {
                dashboard.style.display = "block";
              }
            } else if (currentPage === "signup") {
              signup.style.display = "block";
            } else {
              login.style.display = "block";
            }
          }
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", showPage);
        } else {
          showPage();
        }
      })();
    </script>
  </head>
  <body>
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Header -->
    <header class="main-header">
      <div class="header-content">
        <h1 class="logo" onclick="goToHomePage()" tabindex="0">
          Investment Tracker
        </h1>
        <div class="header-profile">
          <div
            class="profile-icon"
            id="profileIcon"
            onclick="toggleProfileMenu()"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="12"
                cy="8"
                r="4"
                stroke="currentColor"
                stroke-width="2"
                fill="none"
              />
              <path
                d="M20 21a8 8 0 1 0-16 0"
                stroke="currentColor"
                stroke-width="2"
                fill="none"
              />
            </svg>
          </div>
          <div class="dropdown" id="profileDropdown" style="display: none">
            <div class="profile-info">
              <div class="profile-name" id="profileName">User Name</div>
              <div class="profile-email" id="profileEmail">user@email.com</div>
            </div>
            <hr class="profile-divider" />
            <div class="profile-menu-item" onclick="showProfileSettings()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
                  stroke="currentColor"
                  stroke-width="2"
                  fill="none"
                />
                <circle
                  cx="12"
                  cy="12"
                  r="3"
                  stroke="currentColor"
                  stroke-width="2"
                  fill="none"
                />
              </svg>
              Profile Settings
            </div>
            <div class="profile-menu-item" onclick="logout()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"
                  stroke="currentColor"
                  stroke-width="2"
                  fill="none"
                />
                <polyline
                  points="16,17 21,12 16,7"
                  stroke="currentColor"
                  stroke-width="2"
                  fill="none"
                />
                <line
                  x1="21"
                  y1="12"
                  x2="9"
                  y2="12"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
              Logout
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="single-column-container">
      <!-- Login Section -->
      <section class="login-section" id="loginSection" style="display: none">
        <h2 class="section-title">Login</h2>
        <div class="login-form">
          <div class="input-group">
            <input
              type="text"
              class="input-field"
              placeholder="Email"
              id="email"
              required
            />
            <div class="error-message" id="loginEmailError"></div>
          </div>

          <div class="input-group">
            <input
              type="password"
              class="input-field"
              placeholder="Password"
              id="password"
              required
            />
            <div class="error-message" id="loginPasswordError"></div>
          </div>

          <button class="btn-primary login-btn" onclick="handleLogin()">
            Login
          </button>
        </div>

        <div class="signup-link">
          <p>
            Don't have an account?
            <a href="#" onclick="showSignup()">Sign up here</a>
          </p>
        </div>
      </section>

      <!-- Signup Section (Initially Hidden) -->
      <section class="signup-section" id="signupSection" style="display: none">
        <h2 class="section-title">Sign Up</h2>
        <div class="signup-form">
          <div class="input-group">
            <input
              type="text"
              class="input-field"
              placeholder="Full Name *"
              id="fullName"
            />
            <div class="error-message" id="fullNameError"></div>
          </div>

          <div class="input-group">
            <input
              type="email"
              class="input-field"
              placeholder="Email *"
              id="signupEmail"
            />
            <div class="error-message" id="signupEmailError"></div>
          </div>

          <div class="input-group">
            <input
              type="password"
              class="input-field"
              placeholder="Password *"
              id="signupPassword"
            />
            <div class="error-message" id="signupPasswordError"></div>
          </div>

          <div class="input-group">
            <input
              type="password"
              class="input-field"
              placeholder="Confirm Password *"
              id="confirmPassword"
            />
            <div class="error-message" id="confirmPasswordError"></div>
          </div>

          <button class="btn-primary signup-btn" onclick="handleSignup()">
            Sign Up
          </button>
        </div>

        <div class="login-link">
          <p>
            Already have an account?
            <a href="#" onclick="showLogin()">Login here</a>
          </p>
        </div>
      </section>

      <!-- Profile Settings Section (Initially Hidden) -->
      <section
        class="profile-settings-section"
        id="profileSettingsSection"
        style="display: none"
      >
        <h2 class="section-title">Profile Settings</h2>
        <div class="details-dropdown-container">
          <button
            class="details-dropdown-button"
            onclick="toggleDetailsDropdown()"
            tabindex="0"
            role="combobox"
            aria-haspopup="listbox"
            aria-expanded="false"
          >
            <span id="detailsDropdownButtonText">Select detail to update</span>
            <svg
              class="dropdown-arrow"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="6,9 12,15 18,9"></polyline>
            </svg>
          </button>
          <div
            class="details-dropdown"
            id="detailsDropdownMenu"
            style="display: none"
          >
            <div
              class="details-menu-item"
              onclick="selectDetailsDropdownOption('Name'); showEditField('name');"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Name
            </div>
            <div class="details-divider"></div>
            <div
              class="details-menu-item"
              onclick="selectDetailsDropdownOption('Email'); showEditField('email');"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
                ></path>
                <polyline points="22,6 12,13 2,6"></polyline>
              </svg>
              Email
            </div>
            <div class="details-divider"></div>
            <div
              class="details-menu-item"
              onclick="selectDetailsDropdownOption('Password'); showEditField('password');"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <circle cx="12" cy="16" r="1"></circle>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              Password
            </div>
          </div>
        </div>

        <!-- Edit Field Container (Initially Hidden) -->
        <div
          class="edit-field-container"
          id="editFieldContainer"
          style="display: none"
        >
          <div class="input-group">
            <label class="field-label" id="fieldLabel">Edit Field</label>
            <input
              type="text"
              class="input-field"
              id="editFieldInput"
              placeholder="Enter new value"
            />
            <div class="error-message" id="editFieldError"></div>
          </div>

          <!-- Password Confirmation (Hidden by default) -->
          <div
            class="input-group"
            id="confirmPasswordGroup"
            style="display: none"
          >
            <label class="field-label">Confirm New Password</label>
            <input
              type="password"
              class="input-field"
              id="confirmPasswordInput"
              placeholder="Confirm new password"
            />
            <div class="error-message" id="confirmPasswordError"></div>
          </div>

          <div class="edit-field-buttons">
            <button
              type="button"
              class="btn-secondary"
              onclick="cancelFieldEdit()"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn-primary update-btn"
              onclick="saveFieldEdit()"
            >
              Update
            </button>
          </div>
        </div>

        <div class="profile-settings-buttons" style="margin-top: 20px">
          <button
            type="button"
            class="btn-primary back-to-dashboard"
            onclick="cancelProfileSettings()"
          >
            Back to Dashboard
          </button>
        </div>
      </section>

      <!-- Main Dashboard Content (Initially Hidden) -->
      <div id="dashboardContent" style="display: none">
        <!-- Action Buttons Section -->
        <section class="navigation-section">
          <h2 class="section-title">Navigation</h2>
          <div class="action-buttons">
            <button class="action-btn">Portfolio</button>
            <button class="action-btn">Analytics</button>
            <button class="action-btn">Settings</button>
          </div>
        </section>

        <!-- Portfolio Summary Section -->
        <section class="portfolio-summary">
          <h2 class="section-title">Portfolio Summary</h2>
          <div class="summary-cards">
            <div class="data-card">
              <h3>Portfolio Value</h3>
              <p class="value" id="portfolioValue">$0</p>
            </div>

            <div class="data-card">
              <h3>Daily Change</h3>
              <p class="value" id="dailyChange">$0</p>
            </div>

            <div class="data-card">
              <h3>Total Gain</h3>
              <p class="value" id="totalGain">0%</p>
            </div>
          </div>
        </section>

        <!-- Chart Section -->
        <!-- Chart Section -->
        <section class="chart-section">
          <div class="chart-header">
            <h2 class="section-title">Investment Performance</h2>
            <div class="chart-controls">
              <button class="time-btn active">1W</button>
              <button class="time-btn">1M</button>
              <button class="time-btn">3M</button>
              <button class="time-btn">1Y</button>
              <button class="time-btn">ALL</button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="investmentChart"></canvas>
          </div>
        </section>

        <!-- Recent Transactions Section -->
        <section class="transactions-section">
          <h2 class="section-title">Recent Transactions</h2>
          <div class="dashboard-card">
            <div class="transaction-list" id="transactionList">
              <!-- Transactions will be loaded dynamically -->
              <div class="no-data">No transactions yet</div>
            </div>
          </div>
        </section>

        <!-- Holdings Section -->
        <section class="holdings-section">
          <h2 class="section-title">Holdings</h2>

          <!-- Stocks Holdings -->
          <div class="holdings-category">
            <div class="category-header">
              <h3 class="category-title">Stocks</h3>
              <button
                class="btn-primary add-category-btn btn-small btn-auto-width"
                onclick="showAddStockModal()"
              >
                >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Stock
              </button>
            </div>
            <div class="holdings-container">
              <div class="holdings-table">
                <div class="holdings-header">
                  <div class="holding-col">Symbol</div>
                  <div class="holding-col">Company</div>
                  <div class="holding-col">Qty</div>
                  <div class="holding-col">Avg Price</div>
                  <div class="holding-col">Current Price</div>
                  <div class="holding-col">Investment</div>
                  <div class="holding-col">Current Value</div>
                  <div class="holding-col">Gain/Loss</div>
                  <div class="holding-col">Return %</div>
                  <div class="holding-col">Actions</div>
                </div>
                <div class="holdings-body" id="stocksTableBody">
                  <div class="no-holdings">
                    <p>No stocks in portfolio</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Mutual Funds Holdings -->
          <div class="holdings-category">
            <div class="category-header">
              <h3 class="category-title">Mutual Funds</h3>
              <button
                class="btn-primary add-category-btn btn-small btn-auto-width"
                onclick="showAddMutualFundModal()"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Mutual Fund
              </button>
            </div>
            <div class="holdings-container">
              <div class="holdings-table">
                <div class="holdings-header">
                  <div class="holding-col">Scheme</div>
                  <div class="holding-col">Fund Name</div>
                  <div class="holding-col">Units</div>
                  <div class="holding-col">Avg NAV</div>
                  <div class="holding-col">Current NAV</div>
                  <div class="holding-col">Investment</div>
                  <div class="holding-col">Current Value</div>
                  <div class="holding-col">Gain/Loss</div>
                  <div class="holding-col">Return %</div>
                  <div class="holding-col">Actions</div>
                </div>
                <div class="holdings-body" id="mutualFundsTableBody">
                  <div class="no-holdings">
                    <p>No mutual funds in portfolio</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Market Summary Section -->
        <section class="market-section">
          <h2 class="section-title">Market Summary</h2>
          <div class="dashboard-card">
            <div class="market-stats" id="marketStats">
              <!-- Market data removed - offline mode -->
              <div class="no-data">
                Market data not available in offline mode
              </div>
            </div>
          </div>
        </section>
      </div>
      <!-- End Dashboard Content -->
    </div>

    <script src="script.js"></script>
  </body>
</html>
